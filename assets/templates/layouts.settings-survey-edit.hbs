{{> ModeBar }}

<div class="mode-context">

    <header class="mode-context-header">
        <ol class="breadcrumbs">
            <li><a href="map.html">{{deployment.name}}</a></li>
            <li><a href="settings.html">Settings</a></li>
            <li><a href="settings-surveys.html">Surveys</a></li>
        </ol>

        <a href="" class="mode-context-back button button-link">
            <svg class="iconic">
                <use xlink:href="../../img/material/svg-sprite-navigation-symbol.svg#ic_arrow_back_24px"></use>
            </svg>
            <span class="hidden">Back</span>
        </a>

        <h1 class="mode-context-title">Edit Survey</h1>
    </header>

</div>

{{#surveyFromHash}}
<main role="main">

    <div class="toolbar">
        <!--// SAVED //-->
        <span class="status-indicator tooltip success">
            <svg class="iconic">
                <use xlink:href="../../img/iconic-sprite.svg#check"></use>
            </svg>
            <span class="label">All changes saved</span>
            <span class="bug">Every change you make is automatically saved</span>
        </span>

        <!--// SAVING //
        <span class="status-indicator">
            <span class="label">Saving...</span>
        </span>
        //-->

        <div class="button-group">
            <a class="button button-flat button-plain" data-modal="survey-appearance">
                <svg class="iconic">
                    <use xlink:href="../../img/iconic-sprite.svg#brush"></use>
                </svg>
                <span class="button-label hide-until-medium">Appearance</span>
            </a>

            <a class="button button-flat button-plain" data-modal="survey-permissions">
                <svg class="iconic">
                    <use xlink:href="../../img/iconic-sprite.svg#cog"></use>
                </svg>
                <span class="button-label hide-until-medium">Permissions</span>
            </a>

            <a href="post-add.html#{{indexFromHash}}" class="button button-beta" target="_blank">Preview</a>
        </div>
    </div>

    <div class="full-col">

        <section class="form-sheet" role="article">
            <span class="post-band" style="background-color: #{{color}}"></span>

            <header class="form-sheet-summary contenteditable">
                <h1 class="form-sheet-title survey-title" contenteditable="true" placeholder="Untitled survey">{{name}}</h1>
                <p contenteditable="true">{{description}}</p>
            </header>

            {{#each fields}}
            <div class="form-field {{type.control}}" draggable="true">

                <label contenteditable="true" {{#if required}}class="required"{{/if}}>{{label}}</label>

                <p data-fieldgroup-target="field-description-{{@index}}" contenteditable="true">
                    {{#if description}}
                        {{description}}
                    {{else}}
                        Field description
                    {{/if}}
                </p>

                <div class="form-field-preview">
                    {{surveyFieldPreview}}
                </div>

                <span class="dragger">
                    <svg class="iconic">
                        <use xlink:href="../../img/material/svg-sprite-editor-symbol.svg#ic_drag_handle_24px"></use>
                    </svg>
                </span>

                <div class="form-field-config">
                    <div class="form-field">
                        <a class="button button-beta button-flat button-plain" data-toggle="field-type">
                            <svg class="iconic">
                                <use xlink:href="{{icon}}"></use>
                            </svg>
                            <span class="button-label">{{type.name}}</span>
                            <svg class="iconic">
                                <use xlink:href="../../img/iconic-sprite.svg#chevron-bottom"></use>
                            </svg>
                        </a>
                    </div>

                    {{#ifCond type.control 'checkboxes'}}
                    <div class="listing">
                        {{#each options}}
                        <div class="listing-item" draggable="true">
                            <div class="listing-item-select">
                                <span class="dragger">
                                    <svg class="iconic">
                                        <use xlink:href="../../img/material/svg-sprite-editor-symbol.svg#ic_drag_handle_24px"></use>
                                    </svg>
                                </span>
                            </div>
                            <div class="listing-item-secondary">
                                <button class="button-beta button-link">
                                    <svg class="iconic">
                                        <use xlink:href="../../img/material/svg-sprite-content-symbol.svg#ic_remove_circle_24px"></use>
                                    </svg>
                                    <span class="hidden">Remove</span>
                                </button>
                            </div>
                            <div class="listing-item-primary">
                                <h4 class="listing-item-title" contenteditable="true">{{label}}</h4>
                            </div>
                        </div>
                        {{/each}}

                        <div class="listing-item" draggable="true">
                            <div class="listing-item-primary">
                                <h4 class="listing-item-title">
                                    <button class="button-plain">
                                        <svg class="iconic">
                                            <use xlink:href="../../img/iconic-sprite.svg#plus"></use>
                                        </svg>
                                        <span class="button-label">Add checkbox</span>
                                    </button>
                                </h4>
                            </div>
                        </div>
                    </div>
                    {{/ifCond}}

                    {{#ifCond type.control 'select'}}
                    <div class="listing">
                        {{#each options}}
                        <div class="listing-item" draggable="true">
                            <div class="listing-item-select">
                                <span class="dragger">
                                    <svg class="iconic">
                                        <use xlink:href="../../img/material/svg-sprite-editor-symbol.svg#ic_drag_handle_24px"></use>
                                    </svg>
                                </span>
                            </div>
                            <div class="listing-item-secondary">
                                <button class="button-beta button-link">
                                    <svg class="iconic">
                                        <use xlink:href="../../img/material/svg-sprite-content-symbol.svg#ic_remove_circle_24px"></use>
                                    </svg>
                                    <span class="hidden">Remove</span>
                                </button>
                            </div>
                            <div class="listing-item-primary">
                                <h4 class="listing-item-title" contenteditable="true">{{label}}</h4>
                            </div>
                        </div>
                        {{/each}}

                        <div class="listing-item" draggable="true">
                            <div class="listing-item-primary">
                                <h4 class="listing-item-title">
                                    <button class="button-plain">
                                        <svg class="iconic">
                                            <use xlink:href="../../img/iconic-sprite.svg#plus"></use>
                                        </svg>
                                        <span class="button-label">Add option</span>
                                    </button>
                                </h4>
                            </div>
                        </div>
                    </div>
                    {{/ifCond}}

                    {{#ifCond type.control 'location'}}
                    <div class="form-field switch">
                        <label>Use this field to map each response</label>
                        <p data-fieldgroup-target="map-field-location-message">Responses will be geolocated in your deployment's "Map" view using data from this field.</p>
                        <div class="toggle-switch">
                            <input checked class="tgl" id="map-field-location-{{@index}}" type="checkbox" data-fieldgroup-toggle="map-field-location-message">
                            <label class="tgl-btn" for="map-field-location-{{@index}}"></label>
                        </div>
                    </div>

                    <div class="form-field switch">
                        <label>Show a specific region on this field's map</label>
                        <div class="toggle-switch">
                            <input class="tgl" id="area-field-location-{{@index}}" type="checkbox" data-fieldgroup-toggle="area-field-location-picker">
                            <label class="tgl-btn" for="area-field-location-{{@index}}"></label>
                        </div>

                        <div class="form-field form-fieldgroup location" data-fieldgroup-target="area-field-location-picker">
                            <div class="location-wrapper">
                                {{mapEmbed 0 false}}

                                <form role="search" class="searchbar" data-message="search">
                                    <div class="searchbar-input">
                                        <div class="form-field">
                                            <input type="search" maxlength="250" placeholder="Pick a region" value="" />
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    {{/ifCond}}

                    <div class="form-field-actions">

                        <div class="form-field switch">
                            <label>Required</label>
                            <div class="toggle-switch">
                                <input class="tgl" id="require-field-{{@index}}" type="checkbox" {{#if required}}checked{{/if}} />
                                <label class="tgl-btn" for="require-field-{{@index}}"></label>
                            </div>
                        </div>

                        <div>
                            <button class="button-beta button-flat" data-message="delete-field">
                                <svg class="iconic">
                                    <use xlink:href="../../img/iconic-sprite.svg#trash"></use>
                                </svg>
                                <span class="hidden">Delete</span>
                            </button>

                            <button class="button-beta button-flat" data-toggle="dropdown-menu">
                                <svg class="iconic">
                                    <use xlink:href="../../img/iconic-sprite.svg#ellipses"></use>
                                </svg>
                                <span class="hidden">More</span>
                            </button>

                            <div class="dropdown-menu">
                                <div class="form-field checkbox">
                                    <label for="show-field-description-{{@index}}">
                                        Show field description
                                        <input type="checkbox" id="show-field-description-{{@index}}" data-fieldgroup-toggle="field-description-{{@index}}" {{#if description}}checked{{/if}} />
                                    </label>
                                </div>
                                <div class="form-field checkbox">
                                    <label for="include-in-summary-{{@index}}">
                                        Include in response preview
                                        <input type="checkbox" id="include-in-summary-{{@index}}" data-fieldgroup-toggle="response-preview-description-{{@index}}" {{#if postcard}}checked{{/if}} />
                                    </label>
                                    <p data-fieldgroup-target="response-preview-description-{{@index}}">When someone completes this field, their answer will appear in the short preview of their response that appears in Map and Timeline views.</p>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
            {{/each}}

            <div class="form-field center">
                <button class="button" data-toggle="field-type">
                    <svg class="iconic">
                        <use xlink:href="../../img/iconic-sprite.svg#plus"></use>
                    </svg>
                    <span class="button-label">Add field</span>
                </button>
            </div>
        </section>

    </div>

</main>
{{/surveyFromHash}}

{{> Modals }}

<div id="delete-field" class="message">
    <div class="message-body">
        <p><strong>If you delete this field</strong>, all of the data captured within it will also be deleted. Proceed with caution.</p>

        <button class="button-flat message-trigger">Cancel</button>
        <button class="button-destructive message-trigger">Delete this field</button>
    </div>
</div>

<div id="survey-permissions" class="modal">
    <div class="modal-window">
        <h3 class="modal-title">Edit permissions</h3>

        <div class="modal-body">

            <div class="form-field switch">
                <label>Require responses be reviewed before they're published</label>
                <div class="toggle-switch">
                    <input class="tgl" id="post-review" type="checkbox">
                    <label class="tgl-btn" for="post-review"></label>
                </div>
            </div>

            <div class="form-field switch">
                <label>Hide author information</label>
                <p data-fieldgroup-target="hide-author-message">Only people with permission to edit responses will be able to see who submitted them; and only when editing them.</p>
                <div class="toggle-switch">
                    <input class="tgl" id="hide-author" type="checkbox" data-fieldgroup-toggle="hide-author-message">
                    <label class="tgl-btn" for="hide-author"></label>
                </div>
            </div>

            <fieldset>
                <legend>Who can submit responses to this survey</legend>

                <div class="form-field radio icon-input">
                    <label for="survey-add_everyone">
                        <svg class="iconic">
                            <use xlink:href="../../img/iconic-sprite.svg#globe"></use>
                        </svg>
                        <input type="radio" name="survey-add" id="survey-add_everyone" checked />
                        <span class="label">Everyone</span>
                    </label>
                </div>

                <div class="form-field radio icon-input">
                    <label for="survey-add_roles">
                        <svg class="iconic">
                            <use xlink:href="../../img/iconic-sprite.svg#people"></use>
                        </svg>
                        <input type="radio" name="survey-add" id="survey-add_roles" data-fieldgroup-toggle="survey-add_roles" />
                        Specific roles...
                    </label>

                    <div class="form-fieldgroup" data-fieldgroup-target="survey-add_roles">
                        <div class="form-field checkbox">
                            <input type="checkbox" id="survey-add_roles-members" />
                            <label for="survey-add_roles-members">Members</label>
                        </div>

                        <div class="form-field checkbox">
                            <input type="checkbox" id="survey-add_roles-editors" />
                            <label for="survey-add_roles-editors">Editors</label>
                        </div>

                        <div class="form-field checkbox">
                            <input type="checkbox" id="survey-add_roles-operators" />
                            <label for="survey-add_roles-operators">Operators</label>
                        </div>

                        <div class="form-field checkbox">
                            <input type="checkbox" id="survey-add_roles-admins" />
                            <label for="survey-add_roles-admins">Administrators</label>
                        </div>
                    </div>
                </div>

                <div class="form-field radio icon-input">
                    <label for="survey-add_nobody">
                        <svg class="iconic">
                            <use xlink:href="../../img/iconic-sprite.svg#ban"></use>
                        </svg>
                        <input type="radio" name="survey-add" id="survey-add_nobody" data-fieldgroup-toggle="survey-off-message" />
                        <span class="label">Nobody</span>
                    </label>
                    <p data-fieldgroup-target="survey-off-message">Your survey's existing responses will remain visible, but it will not allow new responses.</p>
                </div>
            </fieldset>

        </div>

        <div class="modal-actions">
            <div class="form-field">
                <button class="button-beta button-flat modal-trigger">Cancel</button>
                <button class="button-alpha modal-trigger">Done</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay"></div>
</div>

<div id="survey-appearance" class="modal">
    <div class="modal-window">
        <h3 class="modal-title">Edit appearance</h3>

        <div class="modal-body">
            <p>Your survey's color will be used for map markers, and the left border of the survey and its responses.</p>

            <fieldset data-fieldset-type="color">
                <legend>Survey color</legend>

                <div class="form-field">
                    <label class="hidden">Hex value</label>
                    <input type="text" data-input-type="color" value="#{{deployment.surveys.0.color}}" />
                </div>
            </fieldset>
        </div>

        <div class="modal-actions">
            <div class="form-field">
                <button class="button-beta button-flat modal-trigger">Cancel</button>
                <button class="button-alpha modal-trigger">Done</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay"></div>
</div>

<div class="mainsheet" data-toggle-target="field-type" data-toggle-animate>
    <div class="mainsheet-window">
        <h3 class="mainsheet-heading">Choose a field type</h3>

        <div class="listing grid">

            <div class="listing-item">
                <div class="listing-item-primary">
                    <div class="listing-item-image">
                        <svg class="iconic">
                          <use xlink:href="../../img/material/svg-sprite-editor-symbol.svg#ic_short_text_24px"></use>
                        </svg>
                    </div>

                    <h2 class="listing-item-title"><a href="">Short text</a></h2>
                </div>
            </div>

            <div class="listing-item">
                <div class="listing-item-primary">
                    <div class="listing-item-image">
                        <svg class="iconic">
                            <use xlink:href="../../img/material/svg-sprite-editor-symbol.svg#ic_format_align_left_24px"></use>
                        </svg>
                    </div>

                    <h2 class="listing-item-title"><a href="">Long text</a></h2>
                </div>

            </div>

        </div>

        <div class="listing grid">

            <div class="listing-item">
                <div class="listing-item-primary">
                    <div class="listing-item-image">
                        <svg class="iconic">
                          <use xlink:href="../../img/material/svg-sprite-image-symbol.svg#ic_image_24px"></use>
                        </svg>
                    </div>

                    <h2 class="listing-item-title"><a href="">Image</a></h2>
                </div>
            </div>

            <div class="listing-item">
                <div class="listing-item-primary">
                    <div class="listing-item-image">
                        <svg class="iconic">
                          <use xlink:href="../../img/material/svg-sprite-communication-symbol.svg#ic_location_on_24px"></use>
                        </svg>
                    </div>

                    <h2 class="listing-item-title"><a href="">Location</a></h2>
                </div>
            </div>

            <div class="listing-item">
                <div class="listing-item-primary">
                    <div class="listing-item-image">
                        <svg class="iconic">
                          <use xlink:href="../../img/material/svg-sprite-image-symbol.svg#ic_looks_one_24px"></use>
                        </svg>
                    </div>

                    <h2 class="listing-item-title"><a href="">Number</a></h2>
                </div>
            </div>

            <div class="listing-item">
                <div class="listing-item-primary">
                    <div class="listing-item-image">
                        <svg class="iconic">
                          <use xlink:href="../../img/material/svg-sprite-action-symbol.svg#ic_date_range_24px"></use>
                        </svg>
                    </div>

                    <h2 class="listing-item-title"><a href="">Date</a></h2>
                </div>
            </div>

            <div class="listing-item">
                <div class="listing-item-primary">
                    <div class="listing-item-image">
                        <svg class="iconic">
                          <use xlink:href="../../img/material/svg-sprite-device-symbol.svg#ic_access_time_24px"></use>
                        </svg>
                    </div>

                    <h2 class="listing-item-title"><a href="">Time</a></h2>
                </div>
            </div>

        </div>

        <div class="listing grid">

            <div class="listing-item">
                <div class="listing-item-primary">
                    <div class="listing-item-image">
                        <svg class="iconic">
                          <use xlink:href="../../img/material/svg-sprite-toggle-symbol.svg#ic_radio_button_checked_24px"></use>
                        </svg>
                    </div>

                    <h2 class="listing-item-title"><a href="">Multiple choice</a></h2>
                </div>
            </div>

            <div class="listing-item">
                <div class="listing-item-primary">
                    <div class="listing-item-image">
                        <svg class="iconic">
                          <use xlink:href="../../img/material/svg-sprite-navigation-symbol.svg#ic_arrow_drop_down_circle_24px"></use>
                        </svg>
                    </div>

                    <h2 class="listing-item-title"><a href="">Dropdown</a></h2>
                </div>
            </div>

            <div class="listing-item">
                <div class="listing-item-primary">
                    <div class="listing-item-image">
                        <svg class="iconic">
                          <use xlink:href="../../img/material/svg-sprite-toggle-symbol.svg#ic_check_box_24px"></use>
                        </svg>
                    </div>

                    <h2 class="listing-item-title"><a href="">Checkboxes</a></h2>
                </div>
            </div>

        </div>
    </div>

    <div class="mainsheet-overlay"></div>
</div>

<script>
setTimeout(function() {
    $('.form-field[draggable="true"]:first').click();
}, 1000);
</script>
